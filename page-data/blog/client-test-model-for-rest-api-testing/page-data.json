{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/client-test-model-for-rest-api-testing/","result":{"data":{"site":{"siteMetadata":{"title":"Testing Boss","siteUrl":"https://www.testingboss.com"}},"markdownRemark":{"id":"6ef11d29-cf75-5358-a7b7-f91e20069b21","fields":{"slug":"/client-test-model-for-rest-api-testing/"},"excerpt":"The separation of concerns is a great coding principle to separate code into distinct sections, each having a separate concern. So let’s apply this to test code…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHh6iyIP//EABgQAAMBAQAAAAAAAAAAAAAAAAABEhEC/9oACAEBAAEFAly2QSUzWaf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAEBAQAAAAAAAAAAAAAAAAAAMSD/2gAIAQEABj8CVcf/xAAaEAADAQADAAAAAAAAAAAAAAAAAREhQVFx/9oACAEBAAE/IekXpJaBIWZcJclH/9oADAMBAAIAAwAAABB43//EABURAQEAAAAAAAAAAAAAAAAAABAR/9oACAEDAQE/EKf/xAAWEQEBAQAAAAAAAAAAAAAAAAAAESH/2gAIAQIBAT8QjH//xAAcEAEAAgIDAQAAAAAAAAAAAAABABEhcTFBUbH/2gAIAQEAAT8Qc52IgZDogGviIbdivIMw4s23e5//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Network\"\n        title=\"\"\n        src=\"/static/8132a95b4e127c8759a7e23fae61b36a/4b190/api.jpg\"\n        srcset=\"/static/8132a95b4e127c8759a7e23fae61b36a/e07e9/api.jpg 200w,\n/static/8132a95b4e127c8759a7e23fae61b36a/066f9/api.jpg 400w,\n/static/8132a95b4e127c8759a7e23fae61b36a/4b190/api.jpg 800w,\n/static/8132a95b4e127c8759a7e23fae61b36a/e5166/api.jpg 1200w,\n/static/8132a95b4e127c8759a7e23fae61b36a/b17f8/api.jpg 1600w,\n/static/8132a95b4e127c8759a7e23fae61b36a/77090/api.jpg 4256w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span></p>\n<p>The separation of concerns is a great coding principle to separate code into distinct sections, each having a separate concern. So let’s apply this to test code when writing REST API tests.</p>\n<p>Let’s say we have a address book service that have APIs to perform CRUD operations (create/update/read/delete).</p>\n<p>For example:</p>\n<ul>\n<li>GET <code class=\"language-text\">/contacts/{contactId}</code> to retrieve details of a single contact</li>\n<li>POST <code class=\"language-text\">/contacts</code> to create a contact</li>\n</ul>\n<p>With <a href=\"https://rest-assured.io/\">Rest Assured</a> we can create a contact in a test as follows.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">shouldCreateContact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Contact</span> contact <span class=\"token operator\">=</span> <span class=\"token class-name\">Contact</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withLastName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bond\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withFirstName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"James\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withPhone</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"202-555-0185\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">given</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token comment\">// Log all requests and responses</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">baseUri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:8080/contacts\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">contentType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ContentType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span>contact<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">statusCode</span><span class=\"token punctuation\">(</span><span class=\"token number\">201</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>The client-test model</h2>\n<p>Pretty straightforward, right? Yes, but usually when you have more tests, you would like to prevent setting up all this configuration to perform the actual http request for every test.</p>\n<p>Let’s refactor this with the client-test model:</p>\n<ul>\n<li>The client will contain all configuration to perform http requests</li>\n<li>The test will focus on the test itself (actions, assertions)</li>\n</ul>\n<p>This setup is a clear separation of concerns.</p>\n<p>First, set up a base client that contain common configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">abstract</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">BaseClient</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> baseUri<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">BaseClient</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> baseUri<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseUri <span class=\"token operator\">=</span> baseUri<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">RequestSpecification</span> <span class=\"token function\">requestSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RestAssuredConfig</span> config <span class=\"token operator\">=</span> <span class=\"token class-name\">RestAssured</span><span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">httpClient</span><span class=\"token punctuation\">(</span><span class=\"token function\">httpClientConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setParam</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http.connection.timeout\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">RequestSpecification</span> requestSpecification <span class=\"token operator\">=</span> <span class=\"token class-name\">RestAssured</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">with</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">// Logging each request and response</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ResponseLoggingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RequestLoggingFilter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">baseUri</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>baseUri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">setLoggingFilters</span><span class=\"token punctuation\">(</span>requestSpecification<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">return</span> requestSpecification<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note: this example is simplified, more configuration can be added, e.g. for (de)serializing objects.</p>\n<p>Now, create a <code class=\"language-text\">ContactClient</code> that does the actual http requests.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ContactClient</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">RestClient</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> <span class=\"token constant\">CONTACTS</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"/contacts\"</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">ContactClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span><span class=\"token constant\">BASE_URI</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Response</span> <span class=\"token function\">createContact</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Contact</span> contact<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">requestSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">contentType</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span>contact<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CONTACTS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Response</span> <span class=\"token function\">getContact</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> contactId<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token function\">requestSpec</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">contentType</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token constant\">CONTACTS</span>  <span class=\"token operator\">+</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">+</span> contactId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>OK, back to the test.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ContactClient</span> client <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ContactClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">shouldCreateContact</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Contact</span> contact <span class=\"token operator\">=</span> <span class=\"token class-name\">Contact</span><span class=\"token punctuation\">.</span><span class=\"token function\">newBuilder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withLastName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bond\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withFirstName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"James\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">withPhone</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"202-555-0185\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    client<span class=\"token punctuation\">.</span><span class=\"token function\">createContact</span><span class=\"token punctuation\">(</span>contact<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">statusCode</span><span class=\"token punctuation\">(</span><span class=\"token number\">201</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Conclusion</h2>\n<p>The separation of concerns is a great coding principle which, just like any other good coding principles, should be applied to test code. When implementing REST API tests, a logical separation would be that the test should only contain the steps/actions and the assertions. The part to perform the actual http requests should be abstracted into a so-called client. In this way, the tests are concise and the client(s) are easily extendible and reusable in other tests.</p>","frontmatter":{"title":"Client-Test Model for REST API Testing","date":"2 January 2023","description":"Use client-test model for separation of concerns for REST API testing.","tags":["automation","api","food"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#080808","images":{"fallback":{"src":"/static/8132a95b4e127c8759a7e23fae61b36a/b74b1/api.jpg","srcSet":"/static/8132a95b4e127c8759a7e23fae61b36a/b74b1/api.jpg 1080w,\n/static/8132a95b4e127c8759a7e23fae61b36a/2432c/api.jpg 2160w","sizes":"1080px"},"sources":[{"srcSet":"/static/8132a95b4e127c8759a7e23fae61b36a/4f506/api.webp 1080w,\n/static/8132a95b4e127c8759a7e23fae61b36a/73409/api.webp 2160w","type":"image/webp","sizes":"1080px"}]},"width":1080,"height":1080}}}}}},"pageContext":{"slug":"/client-test-model-for-rest-api-testing/"}},"staticQueryHashes":["1052764262","2841359383","3159585216","3391161144"],"slicesMap":{}}